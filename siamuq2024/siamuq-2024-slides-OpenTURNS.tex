% Copyright (C) 2024 - Joseph Muré

\documentclass{beamer}

%\setbeameroption{hide notes}
%\setbeameroption{show notes}
%\setbeameroption{show only notes}

\input{macros}

\usepackage[
backend=biber,
style=alphabetic,
sorting=ynt
]{biblatex}

\usepackage{tikz}
\usetikzlibrary{positioning}

\renewcommand{\footnotesize}{\tiny}

\addbibresource{siamuq-2022-slides-OpenTURNS.bib}

\title[OpenTURNS]{Overview of OpenTURNS, its new features and its graphical user interface Persalys}

\author[Mur\'e et al.]{
J. Mur\'e \inst{1} \and
J. Pelamatti \inst{1} \and
J. Schueller \inst{2} \and
A. Marion \inst{2}
}

\institute[EDF-Phim\'eca]{
\inst{1} EDF R\&D. 6, quai Watier, 78401, Chatou Cedex - France, joseph.mure@edf.fr \and %
\inst{2} Phimeca Engineering. 18/20 boulevard de Reuilly, 75012 Paris - France, schueller@phimeca.com
}


\date[]{March 1st 2024, SIAM UQ 2024, Trieste, Italy}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}
\lstdefinestyle{mystyle}{
  backgroundcolor=\color{backcolour},   commentstyle=\color{codegreen},
  keywordstyle=\color{magenta},
  numberstyle=\tiny\color{codegray},
  stringstyle=\color{codepurple},
  basicstyle=\ttfamily\tiny,
  breakatwhitespace=false,         
  breaklines=true,                 
  captionpos=b,                    
  keepspaces=true,                 
  numbers=left,                    
  numbersep=5pt,                  
  showspaces=false,                
  showstringspaces=false,
  showtabs=false,                  
  tabsize=1,
  numbers=none
}

\lstset{style=mystyle, language=python}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

  \begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

  \begin{frame}
  \titlepage
  
  \begin{columns}
    \column{0.45\textwidth}
  \begin{center}
\includegraphics[height=0.15\textheight]{figures/edf.jpg}
\end{center}
    \column{0.1\textwidth}
	
    \column{0.45\textwidth}
  \begin{center}
\includegraphics[height=0.15\textheight]{figures/logo_phimeca.png}
\end{center}
  \end{columns}

  \end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \begin{frame}
% \frametitle{Contents}
% \tableofcontents
% \end{frame}

\AtBeginSection[ ]
{
  \begin{frame}
    \frametitle{Contents}
    \tableofcontents[currentsection]
  \end{frame}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{OpenTURNS Overview}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{OpenTURNS: \url{www.openturns.org}}


    \begin{center}
    \includegraphics[width=0.8\textwidth]{figures/OT.pdf}
    \end{center}
	
\begin{itemize}
\item Multivariate probabilistic modeling including dependence
\item Numerical tools dedicated to the treatment of uncertainties
\item Generic coupling to any type of physical model
\item Open source, LGPL licensed, C++/Python library
\end{itemize}


\end{frame}

\note{
OpenTURNS is software for uncertainty quantification, uncertainty propagation,
sensitivity analysis and metamodeling. 

It is available with the open source LGPL licence on Linux, Windows and macOS.

In order to use OpenTURNS, you can use directly the C++ library, or 
program your Python scripts. 
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{OpenTURNS: \url{www.openturns.org}}

\begin{center}
   \begin{tabular}{ccccc}
   \includegraphics[width=0.10\textwidth]{figures/logoEDF_Anne.png}&
   \includegraphics[width=0.12\textwidth]{figures/LogoAirbus.png}&
   \includegraphics[width=0.12\textwidth]{figures/logo_phimeca.png}&
   \includegraphics[width=0.12\textwidth]{figures/logo_Imacs.png}
   \includegraphics[width=0.25\textwidth]{figures/logo_ONERA.jpg}&
   \end{tabular}
\end{center}

\vspace*{0.05cm}
\begin{itemize}
\item Linux, Windows, macOS
\item First release : 2007
\item 5 full time developers
\item Users $\approx 1000$, mainly in France
(1 078 000 Total Conda downloads)
\item Project size : 800  classes, more than 6000 services
\end{itemize}


\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[containsverbatim]
  \frametitle{OpenTURNS: content}
  
  \begin{scriptsize}
  
  \begin{minipage}[t]{0.33\textwidth}
  \begin{itemize}
  \item Data analysis
  \begin{itemize}
  \tiny
  \item Distribution fitting
  \item Statistical tests
  \item Estimate dependency and copulas
  \item Estimate stochastic processes
  \end{itemize}
  \end{itemize}
  \end{minipage}%
  \begin{minipage}[t]{0.33\textwidth}
  \begin{itemize}
  \item Probabilistic modeling
  \begin{itemize}
  \tiny
  \item Dependence modeling
  \item Univariate distributions
  \item Multivariate distrbutions
  \item Copulas
  \item Processes 
  \item Covariance kernels
  \end{itemize}
  \end{itemize}
  \end{minipage}%
  \begin{minipage}[t]{0.33\textwidth}
  \begin{itemize}
  \item Surrogate models
  \begin{itemize}
  \tiny
  \item Linear regression
  \item Polynomial chaos expansion
  \item Gaussian  process regression
  \item Spectral methods
  \item Low rank tensors
  \item Fields metamodel
  \end{itemize}
  \end{itemize}
  \end{minipage}
  
  \vspace{20pt}  
  
  \begin{minipage}[t]{0.33\textwidth}
  \begin{itemize}
  \item Reliability, sensitivity
  \begin{itemize}
  \tiny
  \item Sampling methods
  \item Approximation methods
  \item Sensitivity analysis
  \item Design of experiments
  \end{itemize}
  \end{itemize}
  \end{minipage}%
  \begin{minipage}[t]{0.33\textwidth}
  \begin{itemize}
  \item Calibration
  \begin{itemize}
  \tiny
  \item Least squares calibration
  \item Gaussian calibration
  \item Bayesian calibration
  \end{itemize}
  \end{itemize}
  \end{minipage}%
  \begin{minipage}[t]{0.33\textwidth}
  \begin{itemize}
  \item Numerical methods
  \begin{itemize}
  \tiny
  \item Optimization
  \item Integration
  \item Least squares 
  \item Meshing
  \item Coupling with external codes
  \end{itemize}
  \end{itemize}
  \end{minipage}
  \end{scriptsize}

  \begin{tabular}{@{}c@{}c@{}c@{}c@{}c@{}}
  \includegraphics[width=0.2\textwidth]{figures/plot_kriging.png}&
  \includegraphics[width=0.2\textwidth]{figures/plot_random_walk.png}&
  \includegraphics[width=0.2\textwidth]{figures/plot_sobol_field.png}&
  \includegraphics[width=0.2\textwidth]{figures/plot_monte_carlo.png}&
  \includegraphics[width=0.2\textwidth]{figures/plot_distribution_fitting.png}
  \end{tabular}
\end{frame}
  

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[containsverbatim]
  \frametitle{OpenTURNS: documentation}
  
  \small{
  
  \begin{columns}
      \column{0.5\textwidth}
  
      \begin{center}
      \includegraphics[width=0.8\textwidth]{figures/exClasses.png}
      \end{center}
  
      \column{0.5\textwidth}
  
    \begin{itemize}
    \item \underline{Content}: 
    \begin{itemize}
    \item Programming interface (API)
    \item Examples
    \item Theory
    \end{itemize}
    \item \emph{All} classes and methods 
    are documented, partly automatically.
    \item Examples are automatically tested at \emph{each} update 
    of the code and outputs are checked.
    \end{itemize}
    
  \end{columns}
  
  }
\end{frame}
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[containsverbatim]
  \frametitle{OpenTURNS: practical use}
  
  \small
  \begin{itemize}
  \item Compatibility with most popular python packages
  \begin{itemize}
  \scriptsize
  \item Numpy
  \item Scipy
  \item Matplotlib
  \item scikit-learn
  \end{itemize}
  \vspace{10pt}
  \item Parallel computational with shared memory (TBB)
  \vspace{10pt}
  \item Optimized linear algebra with LAPACK and BLAS 
  \vspace{10pt}
  \item Possibility to interface with a computation cluster
  \vspace{10pt}
  \item Focused towards handling numerical data
  \vspace{10pt}
  \item Installation through conda, pip, packages for various Linux distros and source code
  \end{itemize}
\end{frame}
  

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[containsverbatim]
  \frametitle{Coupling OpenTURNS with computer codes}
  
  \small
  
  OpenTURNS provides a text file exchange based interface in order to perform analyses on complex computer codes
  
  \vspace{10pt}
  
  \begin{columns}
      \column{0.6\textwidth}
      
  \centering
  
  \includegraphics[width=1.\textwidth]{figures/Coupling.pdf}
  
      \column{0.4\textwidth}
  
  \begin{itemize}
  \item Replaces the need for input/output text parsers
  \item Wraps a simulation code under the form of a standard python function
  \item Allows to interface OpenTURNS with a cluster
  \item \href{https://openturns.github.io/otwrapy/master/index.html}{otwrapy}: interfacing tool to allow easy parallelization
  \end{itemize}
  
  \end{columns}
  
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{OpenTURNS 1.22: Functional surrogate model}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usetikzlibrary {arrows.meta} % pour la flèche

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
  \frametitle{Functional surrogate model}
  
  \small
      \begin{itemize}
        \item We want a surrogate $\hat{h}$ of a model $h$ that maps a time series to a vector:
        \begin{equation*}
          h: \mathcal{F}([0, 1], \mathbb{R}^d) \rightarrow \mathbb{R}^p
        \end{equation*}
        % \begin{equation*}
        % \mathbf{X} = (X_1, X_2, \dots, X_d)^{\top} \sim P_{\mathbf{X}} \quad\mbox{over}\quad \mathcal{X} = \times_{i=1}^{d} \mathcal{X}_i
        % \end{equation*}
        % \vspace{-10pt}
        % \begin{equation*}
        % \mathcal{M} : \left|\begin{array}{rcl}
        % \mathcal{X} \subseteq \mathbb{R}^d & \longrightarrow & \mathcal{Y} \subseteq \mathbb{R}\\
        % \mathbf{X} & \longrightarrow & Y = \mathcal{M}(\mathbf{X})
        % \end{array}
        % \right.
        % \end{equation*}
        % \vspace{10pt}
        % \item \textbf{Learning sample} $\rightarrow$ a $n$-size i.i.d. sample of the couple $(\mathbf{X},Y)$:
        % \begin{equation*}
        % \left(\mathbf{X}^{(j)}, Y^{(j)}\right)_{(1\leq j\leq n)} = \left(X_1^{(j)}, X_2^{(j)}, \dots, X_d^{(j)}, Y^{(j)}\right)_{(1\leq j\leq n)}
        % \end{equation*}
        % with $P_{\mathbf{X}^{(j)}} = P_{\mathbf{X}}$ and $Y^{(j)} = \mathcal{M}\left(X_1^{(j)}, X_2^{(j)}, \dots, X_d^{(j)}\right)$, $\forall j \in \{1,\dots,n\}$
      \end{itemize}
  \vspace{-0.7cm}
  \begin{columns}
    \column{0.19\textwidth}
    \centering
    \includegraphics[width=.99\textwidth]{figures/time_series.pdf}
    \column{0.45\textwidth}
    \hspace{-1cm}
    \begin{tikzpicture}
      \draw[line width = 1pt, -{Stealth}] (3.0,0)   -- (3.6,0);
      \node[inner sep=0pt] (russell) at (0,0)
      {\includegraphics[width=.99\textwidth]{figures/scatter_3d.pdf}};
    \end{tikzpicture}
    %\includegraphics[width=.99\textwidth]{figures/scatter_3d.pdf}
    \column{0.15\textwidth}
    % \begin{tikzpicture}
    %   \node[inner sep=0pt] (russell) at (0,0)
    %       {\includegraphics[width=.99\textwidth]{figures/response.pdf}};
    %   \draw[line width = 1pt, -{Stealth}] (-4,0.5)   -- (-3.5,0.5);
    % \end{tikzpicture}
    \includegraphics[width=.99\textwidth, height=2.5\textwidth]{figures/response.pdf}
  \end{columns}

  \end{frame}

  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  
  \begin{frame}[containsverbatim]
  \frametitle{Functional surrogate model: \texttt{FieldToPointFunctionalChaosAlgorithm}}
  
  \begin{itemize}
    \item We build the surrogate $\hat{h} : \mathcal{F}([0, 1], \mathbb{R}^d) \rightarrow \mathbb{R}^p$ from $N$ observations.
    \item Define the observations:
  \end{itemize}

    \begin{lstlisting}
    timegrid = ot.RegularGrid(start, step, N)
    collection = ... # collection of numpy arrays with shape (N, d)
    x = ot.ProcessSample(timegrid, collection) # functional input data
    y = ... # numpy array of shape (N, p)
    \end{lstlisting}
    
    \begin{itemize}
    \item Step 1: for each dimension of the input data, perform PCA.
    \item Step 2: build a polynomial chaos mappling the PCA coefficients to the outputs
    \item The \texttt{FieldToPointFunctionalChaosAlgorithm} experimental class does both steps at once:
    \end{itemize}

    \begin{lstlisting}
    from openturns.experimental import FieldToPointFunctionalChaosAlgorithm
    algo = FieldToPointFunctionalChaosAlgorithm(x, y)
    algo.setThreshold(0.04) # part of the variance unexplained by the PCA
    algo.run()
    result = algo.getResult()
    \end{lstlisting} 
  

  \end{frame}
  
  
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  
  \begin{frame}[containsverbatim]
  \frametitle{Functional surrogate model: validation (case where $p=1$)}
  
  \small
  \begin{lstlisting}
    x_valid = ... # input validation ProcessSample
    y_valid = ... # output values
    surrogate = result.getFieldToPointMetamodel() # h_hat
    yhat_valid = surrogate(x_valid)

    graph = ot.VisualTest.DrawQQplot(y_valid, yhat_valid) # graphical validation
    graph.setTitle("")
    graph.setXTitle("True output values")
    graph.setYTitle("Surrogate model values")
  \end{lstlisting} 

  \centering
  \includegraphics[width=.5\textwidth]{figures/validation.pdf}

  \end{frame}
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  
\begin{frame}[containsverbatim]
\frametitle{Step 1 analysis: visualize and validate PCA modes}
\vspace{-0.3cm}
\begin{columns}
  \begin{column}{0.49\textwidth}
  \begin{lstlisting}
pca_l = result.getInputKLResultCollection()
grid = ot.GridLayout(1, d)
for num, pca in enumerate(pca_l):
    modes = pca.getModesAsProcessSample()
    graph = modes.drawMarginal(0)
    graph.setTitle(f"Dimension #{num}")
    grid.setGraph(0, num, graph)
  \end{lstlisting}    
  \end{column}
  \begin{column}{0.49\textwidth}
    \begin{lstlisting}
for num, pca in enumerate(pca_l):
    m = x.getMarginal(num)
    v = ot.KarhunenLoeveValidation(m, pca)
    graph= v.drawValidation().getGraph(0,0)
    ratio = 100.0 * pca.getSelectionRatio()
    graph.setTitle(f"Ratio = {ratio:.2f}%")
    grid.setGraph(0, num, graph)
    \end{lstlisting}    
    \end{column}  
\end{columns}

\vspace{-0.52cm}
\centering
\includegraphics[width=0.775\textwidth]{figures/pca_modes.pdf}
\includegraphics[width=0.775\textwidth]{figures/pca_validation.png}

\end{frame}
  
  
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  
\begin{frame}[containsverbatim]
\frametitle{Step 2 analysis: polynomial-chaos-derived Sobol' indices}

\begin{lstlisting}
frop openturns.experimental import FieldFunctionalChaosSobolIndices
sensitivity = FieldFunctionalChaosSobolIndices(result)
graph = sensitivity.draw()
\end{lstlisting}

\centering
\includegraphics[width=0.7\textwidth]{figures/sobol.pdf}

\end{frame}
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section[OpenTURNS 1.22: Surrogate with categorical variables]{OpenTURNS 1.22: Surrogate with mixed continuous and categorical variables}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[containsverbatim]
\frametitle{Surrogate with mixed continuous and categorical variables}
\small
\centering

\begin{block}{Mapping categories to a latent space with Gaussian correlation kernel}
\medskip
\centering
\begin{tikzpicture}
    \draw[gray!30] (-1.25,-1.25) grid[xstep=1.0, ystep=1.0]  (2.25,2.25);
    \draw[gray!15] (-1.25,-1.25) grid[xstep=0.5, ystep=0.5]  (2.25,2.25);
    \draw[draw=gray!50,latex-latex] (0,2) +(0,0.5cm) node[above right] {$x_1$} -- (0,-1) -- +(0,-0.5cm);
    \draw[draw=gray!50,latex-latex] (-1,0) +(-0.5cm,0) -- (2,0) -- +(0.5cm,0) node[below right] {$x_0$};
    \filldraw (1.0,1.5) circle[radius=1.5pt];
    %\node [fill, draw, circle, minimum width=3pt, inner sep=0pt, pin={[fill=white, outer sep=2pt]135:P}] at (.5,1) {};
     \node[above = 5pt of {1.0,1.5}, outer sep=2pt,fill=white] {mouse};
    \filldraw (0,0) circle[radius=1.5pt];
    \node[below left=1pt of {0,0}, outer sep=2pt,fill=white] {dog};
    \filldraw (1.5,0) circle[radius=1.5pt];
    \node[below =2pt of {1.5,0}, outer sep=2pt,fill=white] {cat};
    \filldraw (-6, 1.5) circle[radius=1.5pt];
    \node[right =2pt of {-6,1.5}, outer sep=2pt,fill=white] {dog};
    \filldraw (-6, 0.5) circle[radius=1.5pt];
    \node[right =2pt of {-6,0.5}, outer sep=2pt,fill=white] {cat};
    \filldraw (-6, -0.5) circle[radius=1.5pt];
    \node[right =2pt of {-6,-0.5}, outer sep=2pt,fill=white] {mouse};
    \draw[line width = 1pt, -{Stealth}] (-4,0.5)   -- (-2.5,0.5);
\end{tikzpicture}
\vspace{-0.25cm}

\begin{itemize}
  \item First category: automatically mapped to $(0,0,...,0)$: here dog to $(0,0)$.
  \item Second category: automatically mapped to $(x,0,...,0)$: here cat to $(x, 0)$.
\end{itemize}
\vspace{-0.21cm}

\begin{lstlisting}
      from openturns.experimental import LatentVariableModel
      covModel = LatentVariableModel(3, 2) # 3 categories (doc, cat, mouse) in 2D
      activeCoordinates = [1.5, 1.0, 1.5] # [cat_0, mouse_0, mouse_1]
      covModel.setLatentVariables(activeCoordinates)
\end{lstlisting}

\end{block}

\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[containsverbatim]
\frametitle{Example: 1 continuous + 1 boolean variable}
\small
Product of a 5/2 Mat\'ern covariance kernel for the continuous variable and a latent variable kernel for the boolean variable:

\begin{lstlisting}
# Standard 5/2 Matern covariance kernel for the continuous variable
kx = ot.MaternModel()
kx.setNu(2.5) # smoothess

# Latent variable kernel for the boolean variable
from openturns.experimental import LatentVariableModel
kz = LatentVariableModel(2, 1) # 2 categories in a 1D latent space

# Mixed variable kernel: product of the two kernels
kLV = ot.ProductCovarianceModel([kx, kz])
\end{lstlisting}

Set the bounds for the optimization of the kernel parameters:

\begin{lstlisting}
# The latent variable kernel amplitude is set to 1: it is fixed.
param_number = kLV.getParameter().getSize() - 1 # -1 because kz amplitude is fixed
lowerBoundLV = [1e-4] * param_number
upperBoundLV = [2.0] * param_number
boundsLV = ot.Interval(lowerBoundLV, upperBoundLV) # param_number-dimensional interval
\end{lstlisting}

Sample points to initialize the optimization algorithm:
\begin{lstlisting}
unif_coll = [ot.Uniform(lowerBoundLV[i], upperBoundLV[i]) for i in range(param_number)]
initDistLV = ot.ComposedDistribution(unif_coll) # uniform distribution in boundsLV
initSampleLV = initDistLV.getSample(30) # a sample from this distribution to start ...
optAlgLV = ot.MultiStart(ot.NLopt("LN_COBYLA"), initSampleLV) # ... the optimization
\end{lstlisting}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[containsverbatim]
  \frametitle{Example -- continued: Gaussian Process Regression}
\small


\begin{lstlisting}
algoLV = ot.KrigingAlgorithm(x, y, kLV) # x: input, y: output
algoLV.setOptimizationAlgorithm(optAlgLV)
algoLV.setOptimizationBounds(boundsLV)
algoLV.run()
\end{lstlisting}
\vspace{-0.19cm}
\centering
\includegraphics[width=0.82\textwidth]{figures/latent_variable_model.pdf}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%             PERSALYS                        %%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Persalys Overview}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Project overview}
  \begin{itemize}
  \item
    Partnership between \'Electricit\'e De France (EDF) and Phimeca since 2015
  
    \begin{itemize}
    \item
      Developed in C++ using Qt
    \item
      Aiming at maximizing the use of OpenTURNS - through a dedicated GUI
      - for engineers/researchers without a strong coding experience
    \item
      As easy to use as possible while providing the user with help and
      guidelines
    \item
      Benefit from the advanced visualization capability of
      Paraview
    \end{itemize}
  \end{itemize}
  \end{frame}
  
  \begin{frame}{}
  \protect\hypertarget{section}{}
  \begin{itemize}
  
  \item
    Features:
  
    \begin{itemize}
    
    \item
      Uncertainty quantification:
    \item
      Probabilistic model definition
    \item
      Distribution fitting
    \item
      Probability estimate
    \item
      Metamodeling
    \item
      Screening
    \item
      Optimization
    \item
      Design of experiments
    \item
      As generic as possible
  
      
      \item
        Allows for a wide variety of models
      \item
        Can be coupled to external code
    \item
      GUI language in both English and French
    \end{itemize}
  \item
    LGPL license
  \item
    Two releases per year, follows OpenTURNS development
  \item
    Available for free on demand at
    \url{https://persalys.fr}
  
  \end{itemize}
  \end{frame}
  
  \begin{frame}{Persalys installation}
  \protect\hypertarget{persalys-installation}{}
  \begin{itemize}
  
  \item
    Today the material is provided
  \item
    Github: sources
  \item
    For executables you can request the material at
    \url{https://persalys.fr/obtenir.php}
  \item
    Depending on your OS
  
    \begin{itemize}
    
    \item
      Linux -\textgreater{} .AppImage (600 Mo)
    \item
      Windows -\textgreater{} .exe will create a shortcut on your Desktop
      (program is 1.45 Go)
    \end{itemize}
    \item Also distributed by Debian-based GNU/Linux distributions (e.g. Debian, Ubuntu...)
  \end{itemize}
  \end{frame}

  \begin{frame}{Open Persalys and click on ``New study''}
    \centering
    \includegraphics[width=.89\textwidth]{figure/Persalys_GUI.png}
    \end{frame}
    
    \begin{frame}{Create a study}
    
    \includegraphics[width=\textwidth]{figure/Persalys_new_study.png}
    \end{frame}
    
    \begin{frame}{Definition/Evaluation}
    \protect\hypertarget{definitionevaluation}{}
    Models are viewed as a ``black box'' with inputs, outputs and a
    transfer function (TF).
    Persalys supports two model categories:
    
    \begin{itemize}
    \item
      vector to vector (\(X_i \rightarrow Y_i\), emphasized here)
    \item
      vector to 1D field (\(X_i \rightarrow Y_i(t)\))
    \end{itemize}
    
    \medskip

    Vector to vector models can be of the following type:
    
    \begin{itemize}
    
    \item
      Symbolic, TF is a mathematical formula
    \item
      Python, TF is a Python function
    \item
      FMI, TF is provided by an FMU model
    \item
      Coupling, TF is an executable command which reads/writes input/output
      files
    \end{itemize}
    \end{frame}
    
    \begin{frame}{Coupling model definition}
    
    \centering
    
    \includegraphics[width=0.97\textwidth]{figure/model_definition.png}
    
    \end{frame}
    
    \begin{frame}{Study workflow}
      \centering
      
      \includegraphics[width=0.7\textwidth]{figure/StudyWorkflow.png}
      
      \small
      Blocks become available as study content grows and prerequisites are fulfilled.
      \end{frame}

\begin{frame}{Probabilistic models}
  \small
  Each input variable can be associated to a distribution.
  
  Dependencies
  between variables are specified as copulas.
  
  \centering
  
  \includegraphics[width=0.63\textwidth]{figure/overviewProbaModel.png}
  
  \end{frame}

  \begin{frame}{Metamodel (surrogate model) creation}
    \small
    Using an evaluated design of experiments, the user can build a surrogate model (linear
    regression, functional chaos or Gaussian process regression). Validation
    tests are run to check the approximation being made.
    
    \centering
    
    \includegraphics[width=0.59\textwidth]{figure/overviewMetamodel.png}
    
    \end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \section{PERSALYS, the graphical user interface}

% \begin{frame}
% \frametitle{PERSALYS, the graphical user interface of \ot{}}
	
% \begin{columns}
% \column{0.7\textwidth}
	
% \begin{itemize}
% \item Provide a graphical interface of 
% \ot{} in and out of the SALOME integration platform
% \item Features : probabilistic model, 
% 	distribution fitting, central tendency, 
%   sensitivity analysis, probability estimate, 
% 	surrogate modeling (polynomial chaos, kriging), screening (Morris), 
% 	optimization, design of experiments
% \item GUI language : English, French

% \item Partners : EDF, Phim\'eca
% \item Licence : LGPL

% \item Schedule : Since summer 2016, two releases per year, currently V12
% \item On the internet (free) : SALOME\_EDF since 2018 on 
% \url{www.salome-platform.org}

% \end{itemize}

% \column{0.3\textwidth}

% \begin{center}
% \includegraphics[width=0.95\textwidth]{figures/PERSALYS-LOGO.png}
% \end{center}

% \end{columns}


% \end{frame}


% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \begin{frame}
% \frametitle{Calibration}

% Given a physical model $h$, observed inputs $\boldsymbol{x}$, 
% observed outputs $y$ we can calibrate $\boldsymbol{\theta}$ so that 
% $$
% y = h(\boldsymbol{x}, \boldsymbol{\theta}) + \epsilon
% $$
% where $\epsilon$ is a random (Gaussian) variable.

% Calibration outputs:
% \begin{itemize}
% \item the optimal value estimator $\hat{\boldsymbol{\theta}}$,
% \item the distribution of $\hat{\boldsymbol{\theta}}$ and a confidence or credibility 
% interval of each marginal,
% \item the distribution of the residuals $\epsilon = y - h(\boldsymbol{x}, \hat{\boldsymbol{\theta}})$.
% \end{itemize}

% We implemented 4 methods\footnote{M. Baudin \& R. Lebrun, Linear algebra of linear and nonlinear Bayesian calibration. UNCECOMP 2021.} :

% \begin{center}
% \begin{tabular}{lll}
%                      & {\bf Linear} & {\bf Non Linear} \\
% \hline
% No prior             & Least squares & Least squares \\
%                      & linear        &  non linear \\
% \hline
% Gaussian prior       & Linear calib. & 3DVAR \\
% \hline
% \end{tabular}
% \end{center}

% \end{frame}


% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \begin{frame}
% \frametitle{Calibration}

% In PERSALYS, this requires:
% \begin{itemize}
% \item a physical model $h$ with parameters to calibrate, 
% \item a data file containing the observed inputs and outputs.
% \end{itemize}

% \begin{center}
% \includegraphics[width=0.35\textwidth]{figures/calibration_observations_contextMenu.png}
% \end{center}

% \begin{columns}
%   \column{0.5\textwidth}

% On output, we present the optimal value of each calibrated parameter, 
% along with a 95\% confidence interval.

% \column{0.5\textwidth}

% \begin{center}
% \includegraphics[width=0.9\textwidth]{figures/calibration-ks-zv-zm-optimal_focus.png}
% \end{center}

% \end{columns}
% \end{frame}

% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \begin{frame}
%   \frametitle{Calibration}
    
%   \begin{center}
%   \includegraphics[width=0.86\textwidth]{figures/calibration-Zv-prior-posterior.png}
%   \end{center}
  
%   \end{frame}

% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \begin{frame}
% \frametitle{What's next ?}
%   \begin{columns}
%     \column{0.5\textwidth}

% PERSALYS Roadmap : 
% \begin{itemize}
% \item New surrogate models
% \item 2D Fields, 3D Fields
% \item In-Situ fields based on the MELISSA library (with INRIA): 
% when we cannot store the whole sample in memory or on the hard drive, 
% update the statistics (e.g. the mean, Sobol' indices) sequentially, 
% with distributed computing. 
% \end{itemize}

%     \column{0.5\textwidth}

% \begin{center}
% \includegraphics[height=0.5\textheight]{figures/image034.png}
% \end{center}

% 	\end{columns}

% \end{frame}

% \note{

% The next features we plan to add to PERSALYS is the management
% of 2D and 3D stochastic fields. 

% We also work on the use of the MELISSA software which performs 
% in-situ studies. 

% This library allows to perform UQ studies in situations 
% where we cannot store more than a couple of multidimensional fields 
% in memory or on the hard drive. 
% }

% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}

\begin{center}
Thanks !
\end{center}

\begin{center}
Questions ?
\end{center}

\begin{columns}
\column{0.5\textwidth}
\centering
\includegraphics[width=0.5\textwidth]{figures/logo-openturns.png}
\column{0.5\textwidth}

\includegraphics[width=0.8\textwidth]{figures/PERSALYS-LOGO.png}

\end{columns}

\end{frame}
  
\end{document}
